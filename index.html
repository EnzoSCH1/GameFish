<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sea Fish Game</title>
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <!-- âœ… Bouton mobile DOIT Ãªtre dans le body (pas dans head) -->
  <button id="btnDashMobile" class="dash-mobile hidden">DASH</button>

  <div id="scene">
    <div class="layer layer-back" data-depth="0.05"></div>
    <div class="layer layer-mid" data-depth="0.12"></div>
    <div class="layer layer-front" data-depth="0.22"></div>

    <div id="caustics">
      <div class="caustic c1"></div>
      <div class="caustic c2"></div>
    </div>

    <div id="bubbles"></div>
    <div id="swimmers"></div>

    <!-- entitÃ©s: food/bonus/malus/powerups + boss -->
    <div id="entities"></div>
    <div id="boss"></div>
  </div>

  <!-- Curseur poisson (visible tout le temps) -->
  <div id="cursorWrap"><div id="cursorFish"></div></div>

  <!-- Notification d'Ã©vÃ©nement -->
  <div id="eventNotification" class="event-notification hidden">
    <div class="event-notification-content">
      <div class="event-notification-text"></div>
    </div>
  </div>

  <!-- HUD -->
  <div id="hud">
    <div class="hud-top">
      <div>Niveau : <b id="level">1</b></div>
      <div>Objectif : <b id="score">0</b> / <b id="target">15</b></div>
      <div>Temps : <b id="time">30.0</b>s</div>
      <div id="healthDisplay">
        <div style="display: flex; align-items: center; gap: 8px;">
          <span>SantÃ© :</span>
          <div style="width: 100px; height: 20px; background: rgba(0,0,0,0.3); border-radius: 4px; overflow: hidden; border: 1px solid rgba(255,255,255,0.2);">
            <div id="healthBar" style="height: 100%; width: 100%; background: linear-gradient(90deg, #00ff00, #ffff00, #ff6600); transition: width 0.1s; border-radius: 3px;"></div>
          </div>
          <span><b id="health">100</b>/100</span>
        </div>
      </div>
      <div>Combo : <b id="combo">x1</b></div>
      <div>Total : <b id="total">0</b></div>
      <div>Best : <b id="best">0</b></div>
    </div>

    <div class="hud-bottom">
      <button id="btnStart">DÃ©marrer</button>
      <button id="btnReset" class="secondary">Recommencer</button>
      <button id="btnOptions" class="secondary" aria-label="Options avancÃ©es">âš™ï¸</button>

      <label class="toggle">
        <input type="checkbox" id="soundToggle" checked />
        <span>Son</span>
      </label>
    </div>

    <div class="hint">
      DÃ©place la souris â€¢ Espace / clic droit = Dash â€¢ Attrape lâ€™aimant (bleu) â€¢ Ã‰vite le boss !
    </div>
  </div>
  <!-- CLASSEMENT GLOBAL (EN DEHORS DU HUD) -->
  <div id="topLeaderboard" class="top-leaderboard">
    <div class="leaderboard-title">ğŸ† Top 3</div>
    <div id="topLeaderboardList" class="top-leaderboard-list">
      <div class="top-leaderboard-item">-</div>
      <div class="top-leaderboard-item">-</div>
      <div class="top-leaderboard-item">-</div>
    </div>
  </div>
  <!-- OVERLAY -->
  <div id="overlay" class="hidden">
    <div class="panel">
      <div id="overlayTitle">Bienvenue dans Sea Game ğŸŒŠ</div>
      <div id="overlayMsg">Lis les rÃ¨gles puis clique sur DÃ©marrer.</div>

      <!-- âœ… Indication pour dÃ©marrer (menu bienvenue) -->
      <div class="overlay-hint" id="overlayHint">
        â–¶ Appuie sur <b>EntrÃ©e</b> ou clique sur <b>DÃ©marrer</b>
      </div>

      <!-- ğŸ“˜ RÃˆGLES DU JEU (affichÃ©es au lancement) -->
      <div id="rules" class="rules hidden">
        <h3>ğŸŸ Objectif</h3>
        <p>
          Selon le mode choisi, mange les nourritures pour atteindre lâ€™objectif
          avant la fin du temps ou maintenir ta santÃ©.
          Choisis ton mode en haut de l'Ã©cran de dÃ©marrage.
        </p>

        <h3>â±ï¸ Temps</h3>
        <p>
          En mode Normal et Time Attack, mange rapidement pour Ã©viter que le temps ne sâ€™Ã©coule.
          En Endless, pas de limite de temps mais surveille ta santÃ© !
          Certains bonus peuvent tâ€™aider.
        </p>  

        <h3>ğŸ•¹ï¸ ContrÃ´les</h3>
        <ul>
          <li><b>Souris</b> : dÃ©placer le poisson</li>
          <li><b>Doigts (mobile, tablette)</b> : dÃ©placer le poisson</li>
          <li><b>Espace</b> ou <b>clic droit</b> : dash</li>
        </ul>

        <h3>ğŸ½ï¸ Ã‰lÃ©ments</h3>
        <ul>
          <li>ğŸ¥« <b>Nourriture</b> : augmente le score</li>
          <li>âœ¨ <b>Bonus (limace)</b> : temps ou points supplÃ©mentaires</li>
          <li>âš ï¸ <b>Malus (mÃ©duse)</b> : pÃ©nalitÃ© de temps (ou santÃ© en Endless)</li>
          <li>ğŸŒŠ <b>Power Dash (coraux)</b> : dash plus frÃ©quent</li>
          <li>ğŸ§² <b>Power Aimant</b> : attire la nourriture</li>
        </ul>

        <h3>ğŸ  Boutique Aquarium</h3>
        <p>
          Gagne de lâ€™XP pour dÃ©bloquer des skins incroyables !!!
          Sinon dans la boutique de l'aquarium tu peux les acheters, les deux boutons ce trouve en bas Ã  gauche de ton Ã©cran.
        </p>

        

        <h3>â¬†ï¸ Upgrades</h3>
        <p>
          AprÃ¨s chaque niveau rÃ©ussi, choisis un upgrade
          pour amÃ©liorer ton poisson.
        </p>

        <h3>ğŸ¦ˆ Danger</h3>
        <p>
          Ã€ partir du niveau 4, un boss te poursuit.
          Ã‰vite-le ou tu perdras du temps (ou santÃ© en Endless) !
        </p>

        <h3>ğŸ® Modes de jeu</h3>
        <ul>
          <li><b>Normal</b> : Mode classique avec niveaux progressifs et limite de temps (30s initial). Atteins l'objectif pour passer au niveau suivant.</li>
          <li><b>Endless</b> : Survie infinie avec barre de santÃ© (100 PV). Les malus et le boss rÃ©duisent la santÃ©. Pas de limite de temps, mais perte si santÃ© = 0.</li>
          <li><b>Time Attack</b> : 60 secondes pour maximiser le score. Victoire Ã  la fin du chrono avec ton score total.</li>
        </ul>
        <p>
          Classements locaux sauvegardÃ©s pour chaque mode !
        </p>
      </div>

      <!-- ğŸ“Š STATS (uniquement fin de run) -->
      <div id="stats" class="stats hidden">
        <div class="stats-grid">
          <div class="stat"><span>Total</span><b id="stTotal">0</b></div>
          <div class="stat"><span>Best</span><b id="stBest">0</b></div>
          <div class="stat"><span>Niveau atteint</span><b id="stLevel">1</b></div>
          <div class="stat"><span>Nourritures</span><b id="stFood">0</b></div>
          <div class="stat"><span>Bonus</span><b id="stBonus">0</b></div>
          <div class="stat"><span>Malus</span><b id="stMalus">0</b></div>
          <div class="stat"><span>Power-ups</span><b id="stPower">0</b></div>
          <div class="stat"><span>Coups boss</span><b id="stBossHits">0</b></div>
          <div class="stat"><span>Meilleur combo</span><b id="stMaxCombo">x1</b></div>
        </div>
      </div>

      <!-- âœ… UPGRADES (aprÃ¨s niveau rÃ©ussi) -->
<div id="upgrades" class="upgrades hidden">
  <h3>Choisis un upgrade ğŸ</h3>

  <div class="upgrades-grid">
    <button class="upgrade-card" id="upSpeedBtn" type="button">
      <div class="u-title">âš¡ Vitesse</div>
      <div class="u-desc">Ton poisson suit plus vite</div>
      <div class="u-level">Niveau: <b id="upSpeedLv">0</b></div>
    </button>

    <button class="upgrade-card" id="upRadiusBtn" type="button">
      <div class="u-title">ğŸ¥« PortÃ©e</div>
      <div class="u-desc">Mange plus facilement (hitbox)</div>
      <div class="u-level">Niveau: <b id="upRadiusLv">0</b></div>
    </button>

    <button class="upgrade-card" id="upDashBtn" type="button">
      <div class="u-title">ğŸŒŠ Dash</div>
      <div class="u-desc">Dash plus souvent (cooldown â†“)</div>
      <div class="u-level">Niveau: <b id="upDashLv">0</b></div>
    </button>

    <!-- ğŸ†• 4e UPGRADE (gÃ©rÃ© par le JS : raretÃ© + effet alÃ©atoire) -->
    <button class="upgrade-card" type="button">
      <div class="u-title">ğŸ² MystÃ¨re</div>
      <div class="u-desc">Effet alÃ©atoire selon raretÃ©</div>
      <div class="u-level">?</div>
    </button>
  </div>

  <div class="u-footer">
    <button id="btnReroll" type="button" class="secondary">
      Reroll (<span id="rerollCost">5</span> XP)
    </button>
    <button id="btnSkipUpgrade" class="secondary hidden">Passer</button>
    XP: <b id="xpTotalUI">0</b>
  </div>
</div>

<!-- Aquarium button (visible only when overlay/menu is visible) -->
<button id="btnAquarium" class="aquarium" type="button" aria-label="Aquarium">
  ğŸ 
  <span id="aquariumBadge" class="badge">0</span>
</button>
<!-- Shop button (dans l'overlay panel) -->
<button id="btnShop" class="shop hidden" type="button" aria-label="Boutique">
  ğŸ›’
</button>

<!-- Shop overlay -->
<div id="shopOverlay" class="hidden">
  <div class="shop-panel">
    <div class="shop-head">
      <div class="shop-title">Boutique</div>
      <button id="btnCloseShop" type="button" class="secondary">âœ•</button>
    </div>

    <div class="shop-topbar">
      <div class="wallet">Meta XP: <b id="metaXPShop">0</b></div>
    </div>

    <div class="shop-tabs">
      <button id="shopTabCursor" class="tab active" type="button">Poissons</button>
      <button id="shopTabBoss" class="tab" type="button">Boss</button>
    </div>

    <div id="shopGrid" class="shop-grid"></div>
  </div>
</div>


      <!-- Actions -->
      <div class="actions">
        <div id="modeSelection" class="mode-selection">
          <h4>Choisis un mode :</h4>
          <button id="btnNormal" class="mode-btn active">Normal</button>
          <button id="btnEndless" class="mode-btn">Endless</button>
          <button id="btnTimeAttack" class="mode-btn">Time Attack</button>
        </div>
        <button id="btnPlay">Commencer</button>
        <button id="btnNext">Continuer</button>
        <button id="btnRetry" class="secondary">Rejouer</button>
      </div>
    </div>

    <!-- Leaderboard complet (modal) - optionnel maintenant -->
    <div id="leaderboard" class="leaderboard hidden">
      <div class="panel">
        <h3>Classement ğŸ†</h3>
        <div class="leaderboard-tabs">
          <button class="leaderboard-tab active" data-mode="normal">Normal</button>
          <button class="leaderboard-tab" data-mode="endless">Endless</button>
          <button class="leaderboard-tab" data-mode="time_attack">Time Attack</button>
        </div>
        <div id="leaderboardList" class="leaderboard-list">
          <p>Chargement...</p>
        </div>
        <button id="btnCloseLeaderboard" class="secondary">Fermer</button>
      </div>
    </div>
  </div>

  <!-- Dash Cooldown Bar (bas centre) -->
<div id="dashCooldownUI">
  <div id="dashCooldownFill"></div>
</div>

<!-- META XP BAR + Aquarium button (persistent progress) -->
<div id="metaUI">
  <div id="metaXPBar">
    <div id="metaXPFill"></div>
  </div>
  <div id="metaXPText">XP: 0 / 50</div>
</div>

<!-- Aquarium / Skins menu -->
<div id="skinOverlay" class="hidden">
  <div class="skin-panel">
    <div class="skin-head">
      <div class="skin-title">Changer de skin</div>
      <button id="btnCloseSkins" type="button" class="secondary">âœ•</button>
    </div>

    <div class="skin-tabs">
      <button id="tabCursor" type="button" class="tab active">Poisson</button>
      <button id="tabBoss" type="button" class="tab">Boss</button>
    </div>

    <div id="skinGrid" class="skin-grid"></div>

    <div class="skin-foot">
      <div id="skinHint" class="skin-hint">DÃ©bloque des skins via la barre XP ğŸ</div>
    </div>
  </div>
</div>

<!-- TUTORIAL OVERLAY -->
<div id="tutorialOverlay" class="hidden">
  <div class="tutorial-panel">
    <div id="tutorialTitle">Tutoriel - Ã‰tape 1/3</div>
    <div id="tutorialMsg">DÃ©place la souris pour bouger le poisson. Clique sur "Suivant" pour continuer.</div>
    <button id="btnTutorialNext">Suivant</button>
    <button id="btnSkipTutorial">Passer le tutoriel</button>
  </div>
</div>

<!-- Tutorial guiding hand -->
<div id="tutorialHand" class="hidden">ğŸ‘†</div>

<!-- Ã‰CRAN DE CHOIX DE NOM -->
<div id="usernameModal" class="username-modal hidden">
  <div class="username-panel">
    <h2 class="username-title">Bienvenue ! ğŸ‘‹</h2>
    <p class="username-text">Choisis un nom d'utilisateur pour commencer</p>
    <input id="usernameInput" type="text" placeholder="Ton nom...">
    <button id="btnSetUsername">Continuer</button>
    <p id="usernameError" class="username-error"></p>
  </div>
</div>

<!-- Flash rouge dÃ©gÃ¢ts -->
<div id="damageFlash"></div>

<!-- Effet de sang (overlay) -->
<div id="bloodLayer" class="blood-layer hidden" aria-hidden="true"></div>

<!-- Virtual Joystick (Mobile) -->
<div id="joystickContainer" class="joystick-container hidden" aria-hidden="true">
  <div id="joystickBg" class="joystick-bg"></div>
  <div id="joystickStick" class="joystick-stick"></div>
</div>

<!-- Options Panel -->
<div id="optionsOverlay" class="hidden">
  <div class="options-panel">
    <div class="options-head">
      <h3>Options AvancÃ©es</h3>
      <button id="btnCloseOptions" class="secondary" aria-label="Fermer">âœ•</button>
    </div>

    <div class="options-content">
      <div class="option-group">
        <label>Vitesse Boss</label>
        <div class="slider-container">
          <input type="range" id="bossSpeedSlider" min="0.5" max="2.0" step="0.1" value="1.0">
          <span id="bossSpeedValue">1.0x</span>
        </div>
        <small>Ajuste la vitesse du boss (0.5x Ã  2.0x)</small>
      </div>

      <div class="option-group">
        <label>Temps par Niveau</label>
        <div class="slider-container">
          <input type="range" id="timeMultiplierSlider" min="0.5" max="2.0" step="0.1" value="1.0">
          <span id="timeMultiplierValue">1.0x</span>
        </div>
        <small>Ajuste le temps initial (0.5x Ã  2.0x)</small>
      </div>

      <div class="option-group">
        <label class="checkbox-label">
          <input type="checkbox" id="parallaxToggle" checked>
          <span>Parallaxe</span>
        </label>
        <small>DÃ©sactiver le parallaxe pour plus de perf</small>
      </div>

      <div class="option-group">
        <label class="checkbox-label">
          <input type="checkbox" id="causticsToggle" checked>
          <span>Caustiques (LumiÃ¨re)</span>
        </label>
        <small>DÃ©sactiver les reflets lumineux</small>
      </div>

      <div class="option-group">
        <label class="checkbox-label">
          <input type="checkbox" id="swimmersToggle" checked>
          <span>Poissons DÃ©cor</span>
        </label>
        <small>DÃ©sactiver les poissons de fond</small>
      </div>

      <button id="btnResetOptions" class="secondary full-width">RÃ©initialiser par dÃ©faut</button>
    </div>
  </div>
</div>

  <script src="firebase.config.js"></script>
  <script type="module" src="app.js"></script>
</body>
</html>
